[[registering.clients.bootstrap]]
= 使用引导脚本注册客户端

使用引导脚本注册客户端可让您控制参数，并且便于您在需要时一次性注册大量客户端。 此方法适用于 Salt 客户端和传统客户端。

要使用引导脚本注册客户端，建议您先创建一个模板引导脚本，之后可以复制和修改该脚本。 注册客户端时，您创建的引导脚本会在客户端上执行，并会确保所有必要的软件包都部署到该客户端。 引导脚本中包含一些参数，用于确保能够将客户端系统指派给它的基础频道，包括激活密钥和 GPG 密钥。

请务必仔细检查储存库信息，以确保其与基础频道储存库匹配。 如果储存库信息未完全匹配，引导脚本将无法下载正确的软件包。

[NOTE]
====
所有非 SLE 客户端和早于版本 15 的 SLE 客户端都需要引导储存库。 引导储存库包含用于在客户端上安装 Salt 的软件包，以及用于注册 Salt 客户端或传统客户端的软件包。 有关如何创建引导储存库的信息，请参见 xref:client- configuration:bootstrap-repository.adoc[]。
====

如果您要使用 {webui} 引导 Salt 客户端，则在开始前需确保客户端系统中已安装 Python。 对于运行 {sles}{nbsp} 12 或更早版本的 Salt 客户端，还需要 [package]``python- xml`` 软件包。

ifeval::[{uyuni-content} == true]
[IMPORTANT]
.GPG 密钥和 Uyuni 客户端工具
====
Uyuni 客户端工具使用的 GPG 密钥默认不受信任。 创建引导脚本时，请使用 [systemitem]``ORG_GPG_KEY`` 参数添加包含公共密钥指纹的文件的路径。
====
endif::[]

[NOTE]
.openSUSE Leap 15、SLES 15 和 Python 3
====
openSUSE Leap 15 和 SLE 15 默认使用 Python 3。 必须为 openSUSE Leap 15 和 SLE 15 系统创建基于 Python 2 的引导脚本。 如果您使用 Python 2 注册 Leap 15 或 SLE 15 系统，引导脚本将会失败。
====



== Create a Bootstrap Script from {webui}

您可以使用 {productname} {webui} 创建可编辑的引导脚本。

.过程：创建引导脚本
. 在 {productname} {webui} 中，导航到menu:管理[管理器配置 > 引导脚本]。
. 如果您安装的是传统客户端，请在 [guimenu]``SUSE Manager 配置 - 引导``对话框中取消选中[guimenu]``使用 Salt 引导``复选框。
    对于 Salt 客户端，请保留选中状态。
. 必填字段中会预填充从之前的安装步骤获得的值。
    有关每个设置的细节，请参见 xref:reference:admin/bootstrap-script.adoc[]。
. Click btn:[Update] to create the script.
. 服务器上的 [path]``/srv/www/htdocs/pub/bootstrap`` 目录中即会生成并储存引导脚本。
    或者，您也可以通过 HTTPS 访问引导脚本。 请以您的 {productname} 服务器的主机名替换 ``example.com``：
----
https://<example.com>/pub/bootstrap/bootstrap.sh
----


[IMPORTANT]
====
请勿在引导脚本中禁用 SSL。 确保 {webui} 中的 [guimenu]``启用 SSL`` 处于选中状态，或者引导脚本中包含 `USING_SSL=1` 设置。 如果您禁用 SSL，将需要在注册过程中提供自定义 SSL 证书。 有关自定义证书的详细信息，请参见 xref:administration:ssl-certs.adoc[]。
====


[WARNING]
====
要注册并使用 {centos}{nbsp}6、{oracle}{nbsp}6、{rhel}{nbsp}6 或 {sleses}{nbsp}6 客户端，需要配置 {productname} 服务器以支持较旧类型的 SSL 加密。 有关如何解决此错误的详细信息，请参见 xref:client- configuration:tshoot-clients.adoc[] 中的``注册较旧的客户端``。
====



[[modify.bootstrap.script]]
== 编辑引导脚本

您可以复制和修改所创建的模板引导脚本，以对其进行自定义。 要将引导脚本用于 {productname}，对其进行修改时至少需包含激活密钥。 大多数软件包都是使用 GPG 签名的，因此系统上还需要有可信的 GPG 密钥才能安装这些软件包。

在执行此过程时，您需要知道激活密钥的确切名称。 导航到menu:首页[概览]，然后在[guimenu]``任务``框中，单击[guimenu]``管理激活密钥``。 此页面上会列出为频道创建的所有密钥。 您在引导脚本中输入的要使用的密钥完整名称必须与密钥字段中显示的名称完全相同。 有关激活密钥的详细信息，请参见 xref:client-configuration:activation- keys.adoc[]。



.过程：修改引导脚本
. 在 {productname} 服务器上的命令行中，以 root 身份运行以下命令切换到引导目录：
+
----
cd /srv/www/htdocs/pub/bootstrap/
----
. 创建并重命名用于每个客户端的两个模板引导脚本副本。
+
----
cp bootstrap.sh bootstrap-sles12.sh
cp bootstrap.sh bootstrap-sles15.sh
----
. Open [path]``bootstrap-sles15.sh`` for modification.
    向下滚动，直到看到如下所示的文本。 如果文件中包含 ``exit 1``，请在该行的开头键入井号 (&#35;) 将其注释掉。 这样会激活脚本。 在 ``ACTIVATION_KEYS=`` 字段中，输入此脚本的密钥的名称：
+
----
echo "Enable this script: comment (with #'s) this block (or, at least just"
echo "the exit below)"
echo
#exit 1

# can be edited, but probably correct (unless created during initial install):
# NOTE: ACTIVATION_KEYS *must* be used to bootstrap a client machine.
ACTIVATION_KEYS=1-sles15
ORG_GPG_KEY=
----

. 完成后，保存该文件，然后对第二个引导脚本重复此过程。



== 连接客户端

创建好脚本后，您便可以使用它来注册客户端。


.过程：运行引导脚本
. 在 {productname} 服务器上，以 root 身份登录。
    在命令提示符处，运行以下命令切换到引导目录：
+
----
cd /srv/www/htdocs/pub/bootstrap/
----
. 运行以下命令在客户端上执行引导脚本（将 [systemitem]``EXAMPLE.COM`` 替换为客户端的主机名）：
+
----
cat bootstrap-sles15.sh | ssh root@EXAMPLE.COM /bin/bash
----
该脚本会下载位于您先前创建的储存库目录下的所需依赖项。
. 当脚本运行完后，您可以打开 {productname} {webui} 并导航到menu:系统[概览]确定新客户端是否列出，以检查客户端是否已正确注册。
. If you used the script to register the Salt client, open the {productname} {webui} and navigate to menu:Salt[Keys] to accept the client key.

[WARNING]
====
使用 {productname} 在客户端上安装新的软件包或更新时，会自动接受所有最终用户许可协议 (EULA)。 要查看软件包 EULA，请打开 {webui} 中的软件包细节页面。
====


