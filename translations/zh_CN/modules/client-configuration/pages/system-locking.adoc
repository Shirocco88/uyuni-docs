[[system-locking]]
= 系统锁定

系统锁用于防止对客户端执行某些操作。 例如，系统锁可防止更新或重启动客户端。 此功能对于运行生产软件的客户端或想要阻止意外更改时很有用。 您可以在准备好执行操作时禁用系统锁。

传统客户端和 Salt 客户端上实施系统锁的方式不同。



== 传统客户端上的系统锁

当传统客户端被锁定后，便无法使用 {webui} 安排操作，并且在menu:系统[系统列表]中，该客户端名称的旁边会显示一个挂锁图标。



.过程：对传统客户端执行系统锁定
. 在 {productname} {webui} 中，导航到要锁定的客户端的[guimenu]``系统细节``页面。
. 在[guimenu]``锁定状态``下，单击 btn:[锁定此系统]。
    客户端便会保持锁定状态，直到您单击 btn:[解锁此系统]。


在锁定的传统客户端上仍然可以完成某些操作，包括远程命令以及自动进行补丁更新。 要停止自动进行的补丁更新，请导航到相应客户端的[guimenu]``系统细节``页面，然后在[guimenu]``属性``选项卡上取消选中[guimenu]``自动更新补丁``。



== Salt 客户端上的系统锁

当 Salt 客户端被锁定或置于中断模式后，便无法安排操作，并会禁止 Salt 执行命令，而且[guimenu]``系统细节``页面上会显示一个黄色标题。 在此模式下，虽然可以使用 {webui} 或 API 为锁定的客户端安排操作，但操作会失败。


[NOTE]
====
锁定机制不适用于 Salt SSH 客户端。
====



.过程：对 Salt 客户端执行系统锁定
. 在 {productname} {webui} 中，导航到要锁定的客户端的[guimenu]``系统细节``页面。
. 导航到[guimenu]``公式``选项卡，选中系统锁公式，然后单击 btn:[保存]。
. 导航到menu:公式[系统锁]选项卡，选中[guimenu]``锁定系统``，然后单击 btn:[保存]。
    在此页面上，您也可以在客户端处于锁定状态时启用特定的 Salt 模块。
. 进行更改后，您可能需要应用 highstate。
    在此情况下，{webui} 中会显示一个标题通知您。 客户端会保持锁定状态，直到您去除系统锁公式。


[NOTE]
====
如果在节点上检测到 {caasp}，默认会启用系统锁公式。
====

有关 Salt 中的中断模式的详细信息，请参见 https://docs.saltstack.com/en/latest/topics/blackout/index.html。



== 软件包锁

[NOTE]
====
只有在使用 Zypper 软件包管理器的传统客户端上才能使用软件包锁。 {rhel} 或 Salt 客户端上目前不支持该功能。
====

软件包锁用于防止在未经授权的情况下安装或升级传统客户端上的软件包。 当软件包被锁定后，会显示一个挂锁图标，表示无法安装该软件包。 任何尝试安装锁定软件包的操作均会在事件日志中报告为错误。

您无法安装、升级或去除锁定的软件包，无论是通过 {productname} {webui} 还是使用软件包管理器在客户端计算机上直接执行均是如此。 锁定的软件包还会间接锁定任何依赖的软件包。


.过程：使用软件包锁
. 在客户端计算机上，以 [systemitem]``root`` 身份安装 [package]``zypp-plugin-spacewalk`` 软件包：
+
----
zypper in zypp-plugin-spacewalk
----

. 在受管系统上导航到menu:软件[软件包 > 锁定]选项卡查看所有可用软件包的列表。
. 选择要锁定的软件包，然后单击 btn:[请求锁定]。
    您也可以选择输入激活软件包锁的日期和时间。 如果要尽快激活软件包锁，请将日期和时间留空。 请注意，软件包锁可能不会立即激活。
. 要去除软件包锁，请选择要解锁的软件包，然后单击 btn:[请求解锁]。
    如果要尽快停用软件包锁，请将日期和时间留空。 软件包锁可能不会立即停用。
