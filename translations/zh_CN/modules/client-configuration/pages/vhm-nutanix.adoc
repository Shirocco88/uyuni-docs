[[virt-nutanix]]
= 使用 Nutanix 虚拟化

ifeval::[{suma-content} == true]

{suse} 是 Nutanix 的生态系统合作伙伴，SUSE Manager 已获得 "Nutanix AHV integrated" 类别的 Nutanix Ready 认证。

有关 Nutanix 集成的详细信息，请参见 https://www.nutanix.com/partners/technology-alliances/suse

image::nutanix-ready.png[scaledwidth=20%]

endif::[]

您可以通过在 {productname} 中设置虚拟主机管理器 (VHM) 来使用 Nutanix AHV 虚拟机。 开始前，您需要在 {productname} 服务器上设置 VHM，然后清点可用的 VM 主机。



== VHM 设置


虚拟主机管理器 (VHM) 在 {productname} 服务器上运行。

确保您已在 {productname} 服务器上安装 [systemitem]``virtual-host-gatherer-Nutanix`` 软件包。

要运行 VHM，必须打开端口 9440 以使您的 {productname} 服务器可访问 Nutanix Prism Element API。


.过程：创建 Nutanix VHM

. 在 {productname} {webui} 中，导航到menu:系统[虚拟主机管理器]。
. 单击 btn:[创建]，然后选择 [guimenu]``Nutanix AHV``。
. 在[guimenu]``添加 Nutanix AHV 虚拟主机管理器``部分，使用以下参数：
* 在[guimenu]``标签``字段中，为 VHM 键入自定义名称。
* 在[guimenu]``主机名``字段中，键入完全限定的域名 (FQDN) 或主机的 IP 地址。
* 在[guimenu]``端口``字段中，键入要使用的 Prism Element API 端口（例如，[parameter]``9440``）。
* 在[guimenu]``用户名``字段中，键入与 VM 主机关联的用户名。
* 在[guimenu]``口令``字段中，键入与 VM 主机用户关联的口令。
. 单击 btn:[创建] 保存更改并创建 VHM。
. 在[guimenu]``虚拟主机管理器``页面中选择新 VHM。
. 在[guimenu]``属性``页面中，单击 btn:[刷新数据] 以清点新 VHM。

要查看已清点的对象和资源，请导航到menu:系统[系统列表 > 虚拟系统]。


[NOTE]
====
有时，在浏览器中使用 HTTPS 连接 Nutanix Prism API 服务器可能会发生``证书无效``错误。 如果发生此情况，刷新来自虚拟主机管理器的数据将会失败。 Nutanix API 服务器上必须存在有效的 SSL 证书（不是自我签名证书）。 如果您为 Nutanix SSL 证书使用了自定义 CA 机构，请将自定义 CA 证书复制到 {productname} 服务器上的 [path]``/etc/pki/trust/anchors`` 中。 在命令行上运行 [command]``update-ca-certificates`` 命令以重新信任证书，然后重启动 spacewalk 服务。
====

创建并配置好 VHM 后，Taskomatic 即会自动运行数据收集过程。 如果您要手动进行数据收集，请导航到menu:系统[虚拟主机管理器]，选择适当的 VHM，然后单击 btn:[刷新数据]。

{productname} 随附了一个名为 [command]``virtual-host-gatherer`` 的工具，可以使用相应 API 连接到 VHM 并请求虚拟主机的相关信息。 [command]``virtual-host-gatherer`` 计算机会维护可选模块的概念，每个模块可启用一个特定的 VHM。 Taskomatic 会在夜间自动调用此工具。 [command]``virtual-host-gatherer`` 工具的日志文件位于 [path]``/var/log/rhn/ gatherer.log``。
