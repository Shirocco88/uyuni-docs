[[contact-methods-saltssh]]
= Salt SSHでのプッシュ


Salt SSHでのプッシュは、Saltクライアントが{productname}サーバに直接アクセスできない環境で使用されます。 この環境では、DMZと呼ばれるファイアウォール保護ゾーンにクライアントはあります。 内部ネットワークとの接続を開くことを認可されているシステム({productname}サーバなど)はDMZ内にはありません。

Salt SSHでのプッシュメソッドは、DMZにあるクライアントに内部ネットワークの{productname}サーバから暗号化トンネルを作成します。 すべてのアクションおよびイベントが実行された後、トンネルはクローズします。

サーバは、[command]``salt-ssh``ツールを使用して、定期的にクライアントに接続し、チェックインし、スケジュールされたアクションおよびイベントを実行します。 Salt SSHの詳細については、xref:salt:salt-ssh.adoc[]を参照してください。

この接続方法は、Saltクライアントでのみ動作します。 従来のクライアントでは、SSHでのプッシュを使用します。

次のイメージは、Salt SSHでのプッシュプロセスのパスを示しています。 [systemitem]``Taskomatic``ブロックの左側のアイテムはすべて、{productname}クライアントで実行されるプロセスを表します。

image::salt-ssh-contact-taigon.png[scaledwidth=80%]


Salt SSHでのプッシュを使用するには、クライアントで動作しているSSHデーモンが必要で、{productname}サーバで動作している[systemitem]``salt-api``デーモンによって接続できます。 また、Pythonは、リモートシステムで使用できてSaltでサポートされているバージョンである必要があります。

[NOTE]
====
{rhel}{nbsp}5、{centos}{nbsp}5、およびこれら以前のバージョンは、サポートされていないバージョンのPythonを使用しているため、サポートされません。
====


.プロシージャ: Salt SSHでのプッシュを使用したクライアントの登録
. {productname}の{webui}で、menu:システム[ブートストラップ]に移動し、該当するフィールドに入力します。
. SSHでのプッシュ接続メソッドが設定されたアクティベーションキーを選択します。
    アクティベーションキーの詳細については、xref:client-configuration:activation-keys.adoc[]を参照してください。
. ［[systemitem]``Manage System Completely via SSH（SSHでシステムを完全に管理する）``］チェックボックスにチェックを付けます。
. ［btn:[ブートストラップ]］をクリックして、登録を開始します。
. menu:システム[概要]に移動して、システムが正しく登録されたことを確認します。



== 使用可能なパラメータ

Salt SSHでのプッシュを設定している場合、ホスト、アクティベーションキー、パスワードなど、システムを登録するときに使用するパラメータを変更できます。 このパスワードはブートストラップでのみ使用し、どこにも保存されません。 今後のSSHセッションではすべて、キー/証明書のペアで認可されます。 これらのパラメータはmenu:システム[ブートストラップ]で設定されます。

sudoユーザなどシステム全体で使用される永続パラメータも設定できます。 sudoユーザの設定について詳しくは、xref:client-configuration:contact-methods-pushssh.adoc[]を参照してください。



== アクションの実行

Salt SSHでのプッシュ機能は、taskomaticを使用し、[command]``salt-ssh``を使用してスケジュール済みのアクションを実行します。 taskomaticジョブは、スケジュールされたアクションを定期的に確認して実行します。 従来のクライアントにおけるSSHでのプッシュと異なり、Salt SSHでのプッシュ機能は、スケジュールされたアクションに基づいて、完全な[command]``salt-ssh``コールを実行します。

デフォルトでは、20個のSalt SSHアクションを同時に実行できます。 同時実行できるアクションの個数を増やすことができます。そのためには、次の行を設定ファイルに追加し、``parallel_threads``の値を調整します。 問題の発生を回避するために、同時実行アクション数を低い値に保つことをお勧めします。

----
taskomatic.com.redhat.rhn.taskomatic.task.SSHMinionActionExecutor.parallel_threads  = <number>
 org.quartz.threadPool.threadCount = <value of parallel_threads + 20>
----

1つのクライアントで同時実行できるアクションの個数とtaskomaticで使用されるワーカスレッドの合計数が調整されます。 複数のクライアントでアクションを実行する必要がある場合、アクションは常に各クライアントで順次実行されます。

クライアントがプロキシ経由で接続されている場合、プロキシの``MaxSessions``設定を調整する必要があります。 この場合、平行接続数を総クライアント数の3倍に設定します。



== 今後の機能

Salt SSHでのプッシュでサポートされていない機能があります。 これらの機能はSalt SSHクライアント上では動作しません。

* OpenSCAPの監査
* ビーコン。次の結果になります。
** [command]``zypper``を使用してシステムのパッケージをインストールしても、パッケージ更新が呼び出されません。
** 仮想ホストシステムがSalt SSHベースの場合、仮想ホスト関数(たとえば、ゲストへのホスト)が動作しません。


Salt SSHの詳細については、https://docs.saltstack.com/en/latest/topics/ssh/を参照してください。
