[[activation-keys]]
= アクティベーションキー

アクティベーションキーは従来のクライアントとSaltクライアントで使用し、クライアントが正しいソフトウェアのエンタイトルメントを持ち、適切なチャンネルに接続して関連グループに加入するようします。 それぞれのアクティベーションキーは、キーを作成するときに設定できる組織にひもづけされます。

{productname}では、アクティベーションキーは、ラベルの付いた一連の設定です。 アクティベーションキーに関連付けられている設定は、すべて適用できます。そのためには、キーのラベルをパラメータにしてブートストラップスクリプトに追加します。 アクティベーションキーラベルをブートストラップスクリプトと組み合わせて使用することをお勧めします。 ブートストラップスクリプトが実行されると、そのラベルに関連付けられているすべての設定が、スクリプトを実行しているシステムに適用されます。

アクティベーションキーは以下を指定できます。

* チャンネルの割り当て
* システムの種類またはアドオンのエンタイトルメント
* 接続メソッド
* 設定ファイル
* インストールするパッケージ
* システムグループの割り当て

アクティベーションキーは、クライアント登録時に使用され、再使用されることはありません。 アクティベーションキーで指定する内容に関係なく、クライアントは登録後、任意の方法で変更できます。 アクティベーションキーとクライアントの関連付けは、履歴を残すためだけに記録されます。

image::provision-config-keys.png[scaledwidth=80%]



.プロシージャ: アクティベーションキーの作成
. {productname}の{webui}で、管理者としてmenu:システム[アクティベーションキー]に移動します。
. ［btn:[キーの作成]］ボタンをクリックします。
. On the [guimenu]``Activation Key Details`` page, in the [guimenu]``Description`` field, enter a description of the activation key.
. In the [guimenu]``Key`` field, enter a name for the activation key.
    たとえば、{sles}{nbsp}12{nbsp}SP4では``SLES12-SP4``です。
+
[IMPORTANT]
====
{suse}製品の［[guimenu]``キー``］フィールドではカンマを使用しないでください。 ただし、Red Hat製品ではカンマを使用する必要があります。 詳細については、xref:reference:systems/activation-keys.adoc[]を参照してください。
====
+
. ［[guimenu]``ベースチャンネル``］ドロップダウンボックスで、適切なベースソフトウェアチャンネルを選択し、関連する子チャンネルへのデータ入力を許可します。
    詳細については、xref:reference:admin/setup-wizard.adoc#vle.webui.admin.wizard.products[]とxref:administration:custom-channels.adoc[]を参照してください。
. 必要な子チャンネルを選択します(必須の{susemgr}ツールや更新チャンネルなど)。
. Check the [guimenu]``Add-On System Types`` check box if you need to enable any of the options.
. ［[guimenu]``接続メソッド``］は［[guimenu]``デフォルト``］のままにすることをお勧めします。
. ［[guimenu]``汎用デフォルト``］設定には、チェックを入れないようにすることをお勧めします。
. ［btn:[アクティベーションキーの作成]］をクリックしてアクティベーションキーを作成します。
. ［[guimenu]``設定ファイルの展開``］チェックボックスをチェックし、このキーの設定管理を有効にし、［btn:[アクティベーションキーの更新]］をクリックしてこの変更を保存します。

[NOTE]
====
［[guimenu]``設定ファイルの展開``］チェックボックスは、アクティベーションキーを作成するまで表示されません。 設定管理を有効にする必要がある場合、前に戻ってボックスにチェックを付けます。
====



== Combining Multiple Activation Keys

従来のクライアントでブートストラップスクリプトを実行するとき、アクティベーションキーを結合できます。 キーを結合すると、システムにインストールされる機能をより詳細に制御でき、大規模な環境や複雑な環境でのキーの重複が軽減されます。

[NOTE]
====
アクティベーションキーの結合は、従来のクライアント上でのみ動作します。 Saltクライアントはアクティベーションキーの結合をサポートしていません。 Saltクライアントで結合キーを使用する場合、最初のキーのみ使用されます。
====

コマンドプロンプトまたはシングル自動インストールプロファイルで複数のアクティベーションキーを指定できます。

{productname}サーバのコマンドプロンプトで、[command]``rhnreg_ksコマンドを使用し、カンマでキーの名前を区切ります。 {kickstart}プロファイルで複数のキーを指定するには、menu:システム[自動インストール]に移動し、使用するプロファイルを編集します。

値が競合するとクライアントの登録に失敗するため、アクティベーションキーを結合するときには注意してください。 結合する前に次の値で情報の競合がないことを確認してください。

* ソフトウェアパッケージ
* ソフトウェアの子チャンネル
* 設定チャンネル。

競合は、検出されると次のように処理されます。

* ベースソフトウェアチャンネルの競合: 登録は失敗します。
* システムの種類の競合: 登録は失敗します。
* `enable configuration`フラグの競合: 設定管理が有効になります。
* 一方のキーがシステム固有のキーである場合: 登録は失敗します。



== 再アクティベーションキー

クライアントを再登録してすべての{productname}設定を再取得するために、再アクティベーションキーを1回だけ使用できます。 再アクティベーションキーはクライアント固有で、システムID、履歴、グループ、およびチャンネルが含まれています。

再アクティベーションキーを作成するには、［[guimenu]``システム``］に移動し、再アクティベーションキーを作成するクライアントをクリックし、menu:詳細[再アクティベーション]タブに移動します。 ［btn:[新しいキーの生成]］をクリックして再アクティベーションキーを作成します。 後で使用できるようにキーの詳細を書き留めます。 特定のシステムIDに関連付けられていない通常のアクティベーションキーと異なり、ここで作成されるキーは、menu:システム[アクティベーションキー]ページに表示されません。

Saltクライアントの場合、再アクティベーションキーを作成した後、[path]``/etc/salt/minion.d/susemanager.conf``の``management_key`` grainとして使用できます。次に例を示します。

----
grains:
    susemanager:
         management_key: "re-1-daf44db90c0853edbb5db03f2b37986e"
----

[command]``salt-minion``プロセスを再起動して再アクティベーションキーを適用します。

ブートストラップスクリプトで再アクティベーションキーを使用できます。 ブートストラップスクリプトの詳細については、xref:client-configuration:registration-bootstrap.adoc[]を参照してください。

従来のクライアントの場合、再アクティベーションキーを作成した後、[command]``rhnreg_ks``コマンドラインユーティリティでこのキーを使用できます。 このコマンドを実行すると、クライアントが再登録され、その{productname}設定が復元されます。 従来のクライアントでは、再アクティベーションキーをアクティベーションキーと結合して、単一システムプロファイルで複数のキーの設定を集約できます。 次に例を示します。

----
rhnreg_ks --server=<server-url>/XMLRPC \
          --activationkey=<reactivation-key>,<activationkey> \
           --force
----

[WARNING]
====
既存の{productname}プロファイルでクライアントを自動インストールすると、そのプロファイルは、再アクティベーションキーを使用して、システムを再登録し、その設定を復元します。 プロファイルベースの自動インストール実行中は、このキーを再生成、削除、または使用しないでください。 このような操作を実行すると、自動インストールは失敗します。
====



== アクティベーションキーのベストプラクティス

.デフォルトの親チャンネル

[systemitem]``SUSEマネージャのデフォルト``の親チャンネルを使用しないでください。 この設定では、{productname}は、インストールされるオペレーティングシステムに最適な親チャンネルを強制的に選択します。その場合、予期しない動作が発生する可能性があります。 代わりに、それぞれのディストリビューションおよびアーキテクチャに固有のアクティベーションキーを作成することをお勧めします。

.アクティベーションキーによるブートストラップ

ブートストラップスクリプトを使用している場合、各スクリプトにアクティベーションキーを作成することを検討してください。 作成によって、チャンネルの割り当て、パッケージのインストール、システムグループメンバーシップ、および設定チャンネルの割り当ての整合性を取ることができます。 登録後にシステムで手動操作する必要も減ります。

.帯域幅の要件

アクティベーションキーを使用すると、登録時にソフトウェアが自動ダウンロードされることがあります。この動作は、帯域幅に制約がある環境では望ましくない場合があります。

次のオプションによって帯域幅使用条件が作成されます。

* SUSE Product Poolチャンネルを割り当てると、対応する製品ディスクリプタパッケージが自動インストールされます。
* ［[guimenu]``パッケージ``］セクションのパッケージがインストールされます。
* ［[guimenu]``設定``］セクションのSaltの状態によっては、その内容に応じてダウンロードがトリガされる場合があります。

.キーラベルの命名

読んで理解しやすい名前をアクティベーションキーに入力しないと、システムが数値の文字列を自動生成するため、キーの管理が困難になる場合があります。

キーを追跡できるようにアクティベーションキーの命名規則を検討してください。 組織のインフラストラクチャに関係がある名前を付けておくと、複雑な操作の実行も簡単になります。

キーラベルを作成する場合、次のヒントを考慮してください。

* OSの名前(必須): キーには、設定を指定するOS名を必ず含める必要があります。
* アーキテクチャ名(推奨): 会社で稼働しているアーキテクチャ(たとえば、x86_64)が複数ある場合、アーキテクチャの種類をラベルに含めることをお勧めします。
* サーバの種類の名前: このサーバの使用目的
* 場所名: サーバの配置場所(部屋、ビル、部署)
* 日付: 保守期間(四半期など)。
* カスタム名: 組織のニーズに合う命名規則

アクティベーションキーラベルの名前の例:

----
sles12-sp2-web_server-room_129-x86_64
----

----
sles12-sp2-test_packages-blg_502-room_21-ppc64le
----

[IMPORTANT]
====
{suse}製品の［[guimenu]``キー``］フィールドではカンマを使用しないでください。 ただし、Red Hat製品ではカンマを使用する必要があります。 詳細については、xref:reference:systems/activation-keys.adoc[]を参照してください。
====

.含めるチャンネル

アクティベーションキーを作成するときは、このキーに関連付けられているソフトウェアチャンネルも考慮する必要があります。 キーには、特定のベースチャンネルを割り当てる必要があります。 デフォルトのベースチャンネルの使用はお勧めしません。 詳細については、xref:client-configuration:registration-overview.adoc[]でインストールしているクライアントオペレーティングシステムを参照してください。


