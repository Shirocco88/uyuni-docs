[[clients-centos]]
= {centos}クライアントの登録

このセクションでは、{centos}オペレーティングシステムを実行している従来のクライアントおよびSaltクライアントの登録について説明します。

[IMPORTANT]
====
{centos}クライアントは、{centos}に基づいていて、{sleses}、RES、{redhat}、または{es}とは関係がありません。 {centos}ベースメディアリポジトリと{centos}インストールメディアへのアクセス管理、および{productname}サーバの{centos}コンテンツデリバリネットワークへの接続は、ユーザが行います。
====

[NOTE]
====
従来のクライアントは{centos}{nbsp}8では使用できません。 {centos}{nbsp}8クライアントはSaltクライアントとしてのみサポートされます。
====

[NOTE]
====
{centos}クライアントの{productname}への登録は、``ターゲット``ポリシーで``適用``されるデフォルトのSELinux設定でテストされます。 SELinuxを無効にして{centos}クライアントを{productname}に登録する必要があります。
====



== ソフトウェアチャンネルの追加

{centos}クライアントを{productname}サーバに登録する前に、必要なソフトウェアチャンネルを追加して同期する必要があります。

ifeval::[{suma-content} == true]

このプロシージャで必要な製品は次のとおりです。

[[centos-channels-wizard]]
[cols="1,1", options="header"]
.CentOS製品 - WebUI
|===
| OSバージョン | 製品名
|{centos} 6 | CentOS 6 x86_64
 | {centos} 7 | CentOS 7 x86_64
 | {centos} 8 | CentOS 8 x86_64
|===

[NOTE]
====
{centos} 6はサポート終了になっており、そのリポジトリで提供されるISOイメージは失効しています。 これらのパッケージを使用した新しい{centos} 6クライアントのブートストラップは失敗します。 新しい{centos} 6クライアントをブートストラップする必要がある場合、xref:client-configuration:tshoot-clients.adoc[]のトラブルシューティングプロシージャに従ってください。
====

include::snippets/addchannels_vendor_webui.adoc[]

または、コマンドプロンプトでチャンネルを追加できます。 このプロシージャで必要なチャンネルは次のとおりです。

[[centos-channels-suma-cli]]
[cols="1,1", options="header"]
.CentOSチャンネル - CLI
|===
| OSバージョン | ベースチャンネル
|{centos} 6 | centos6-x86_64
 | {centos} 7 | centos7-x86_64
 | {centos} 8 | centos8-x86_64
|===

[NOTE]
====
{centos} 6はサポート終了になっており、そのリポジトリで提供されるISOイメージは失効しています。 これらのパッケージを使用した新しい{centos} 6クライアントのブートストラップは失敗します。 新しい{centos} 6クライアントをブートストラップする必要がある場合、xref:client-configuration:tshoot-clients.adoc[]のトラブルシューティングプロシージャに従ってください。
====

include::snippets/addchannels_vendor_cli.adoc[]

endif::[]

ifeval::[{uyuni-content} == true]
このプロシージャで必要なチャンネルは次のとおりです。

[[centos-channels-uyuni-cli]]
[cols="1,1,1,1", options="header"]
.CentOSチャンネル - CLI
|===
| OS Version | Base Channel | Client Channel       | Updates/Appstream Channel
| {centos} 6 | centos6      | centos6-uyuni-client | centos6-updates
| {centos} 7 | centos7      | centos7-uyuni-client | centos7-updates
| {centos} 8 | centos8      | centos8-uyuni-client | centos8-appstream
|===

[NOTE]
====
{centos} 6はサポート終了になっており、そのリポジトリで提供されるISOイメージは失効しています。 これらのパッケージを使用した新しい{centos} 6クライアントのブートストラップは失敗します。 新しい{centos} 6クライアントをブートストラップする必要がある場合、xref:client-configuration:tshoot-clients.adoc[]のトラブルシューティングプロシージャに従ってください。
====

include::snippets/addchannels_novendor_cli_multiarch.adoc[]

[NOTE]
====
[command]``spacewalk-common-channels``によって提供されるクライアントツールのチャンネルの提供元は{uyuni}です。{suse}ではありません。
====

endif::[]


[IMPORTANT]
====
{centos} 8クライアントでは、ベースチャンネルとAppStreamチャンネルの両方を追加します。 両方のチャンネルのパッケージが必要です。 両方のチャンネルを追加しないと、パッケージ不足のためブートストラップリポジトリを作成できません。
====


[NOTE]
====
上流のチャンネルと{productname}チャンネルの間のAppStreamチャンネルで利用できるパッケージ数に不一致が発生する場合があります。 また、同時に別の場所で追加したチャンネルを比較すると、数値が異なる場合もあります。 {centos}でリポジトリを管理する方法が原因です。 {centos}では新しいバージョンがリリースされると古いバージョンのパッケージが削除されますが、{productname}では経過年数に関係なくすべてのバージョンが保持されます。
====


include::snippets/appstream_admon.adoc[]


== 同期ステータスの確認

ifeval::[{suma-content} == true]

include::snippets/check_sync_webui_suma.adoc[]

endif::[]


ifeval::[{uyuni-content} == true]

include::snippets/check_sync_webui_uyuni.adoc[]

endif::[]


include::snippets/check_sync_cli.adoc[]



== アクティベーションキーの作成

{centos}チャンネルと関連付けられているアクティベーションキーを作成する必要があります。

アクティベーションキーの詳細については、xref:client-configuration:activation-keys.adoc[]を参照してください。



ifeval::[{uyuni-content} == true]

== クライアントでGPGキーを信頼する

include::snippets/trust_gpg.adoc[]

endif::[]



== クライアントの登録

{centos}クライアントは、その他すべてのクライアントと同じ方法で登録されます。 詳細については、xref:client-configuration:registration-overview.adoc[]を参照してください。


[WARNING]
====
{centos}{nbsp}6クライアントを登録して使用するには、{productname}サーバを設定して旧式のSSL暗号化をサポートする必要があります。 このエラーを解決する方法については、``古いクライアントの登録``をxref:client-configuration:tshoot-clients.adoc[]で参照してください。
====



== エラータの管理

{centos}クライアントを更新するとき、パッケージには更新に関するメタデータは含まれていません。 サードパーティのエラータサービスを使用してこの情報を取得できます。

[WARNING]
====

ifeval::[{suma-content} == true]

ここで説明するサードパーティのエラータサービスであるCEFSは、コミュニティによって提供され、維持管理されます。 これは{suse}ではサポートされていません。

endif::[]

CEFSの作成者は、パッチまたはエラータを、利便性向上を目指して努力ベースで提供していますが、これが正確であることや最新であることを保証していません。 つまり、パッチ日が正しくない場合があります。また、発行されたデータが1カ月以上遅れて示されたことが少なくとも1回ありました。 このような場合の情報については、https://github.com/stevemeier/cefs/issues/28#issuecomment-656579382およびhttps://github.com/stevemeier/cefs/issues/28#issuecomment-656573607を参照してください。

パッチデータに問題または遅れがあると、信頼できないパッチ情報が{productname}サーバにインポートされる場合があります。 その結果、レポート、監査、CVEの更新、またはその他のパッチ関連の情報も誤りになります。 セキュリティ関連の要件や証明書の条件に応じて、パッチデータを独立して確認する方法や、異なるオペレーティングシステムを選択する方法など、このサービスを使用する方法の代替方法を検討してください。
====




.プロシージャ: エラータサービスのインストール

. {productname}サーバでコマンドプロンプトからrootとして``sle-module-development-tools``モジュールを追加します。
+
----
SUSEConnect --product sle-module-development-tools/15.2/x86_64
----
. エラータサービスの依存関係をインストールします。
+
----
zypper in  perl-Text-Unidecode
----
. [path]``/etc/rhn/rhn.conf``で次の行を追加または編集します。
+
----
java.allow_adding_patches_via_api =  centos7-updates-x86_64,centos7-x86_64,centos7-extras-x86_64
----
. Tomcatを再起動します。
----
systemctl restart tomcat
----
. エラータスクリプト用のファイルを作成します。
+
----
touch /usr/local/bin/cent-errata.sh
----
. 新しいファイルを編集してこのスクリプトを含め、必要に応じてリポジトリの詳細を編集します。
    このスクリプトは、外部のエラータサービスからエラータの詳細をフェッチして展開し、詳細を発行します。
+
----
#!/bin/bash
mkdir -p /usr/local/centos
 cd /usr/local/centos
 rm *.xml
 wget -c http://cefs.steve-meier.de/errata.latest.xml
 #wget -c https://www.redhat.com/security/data/oval/com.redhat.rhsa-all.xml
 wget -c  https://www.redhat.com/security/data/oval/com.redhat.rhsa-RHEL7.xml
 wget -c http://cefs.steve-meier.de/errata-import.tar
 tar xvf errata-import.tar
 chmod +x /usr/local/centos/errata-import.pl
 export SPACEWALK_USER='<adminname>';export SPACEWALK_PASS='<password>'
 /usr/local/centos/errata-import.pl --server '<servername>' \
 --errata /usr/local/centos/errata.latest.xml  \
 --include-channels=centos7-updates-x86_64,centos7-x86_64,centos7-extras-x86_64  \
 --publish --rhsa-oval /usr/local/centos/com.redhat.rhsa-RHEL7.xml
----
. スクリプトを毎日実行するようcronジョブを設定します。
+
----
ln -s /usr/local/bin/cent-errata.sh /etc/cron.daily
----

このツールの詳細については、https://cefs.steve-meier.de/を参照してください。
