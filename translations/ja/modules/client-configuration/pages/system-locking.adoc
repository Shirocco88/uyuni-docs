[[system-locking]]
= システムのロック

システムのロックは、クライアントでアクションが発生しないようにするために使用されます。 たとえば、システムのロックは、クライアントの更新または再起動が行われないようにします。 これは、運用ソフトウェアを実行しているクライアントに対して、または不注意による変更が行われないようにするために役に立ちます。 アクションを実行する準備ができたときにシステムのロックを無効にできます。

システムのロックは、従来のクライアントおよびSaltクライアントでは異なる方法で実装されています。



== 従来のクライアントのシステムのロック

従来のクライアントがロックされると、{webui}を使用してアクションをスケジュールすることができず、menu:システム[システム一覧]にあるクライアントの名前の横に南京錠のアイコンが表示されます。



.プロシージャ: 従来のクライアントのシステムのロック
. {productname}の{webui}で、ロックするクライアントの［[guimenu]``システムの詳細``］ページに移動します。
. ［[guimenu]``ロックの状態``］で、［btn:[Lock this system（このシステムをロックする）]］をクリックします。
    このクライアントは、［btn:[Unlock this system（このシステムのロックを解除する）]］をクリックするまでロックされたままになります。


ロックされた従来のクライアントでは、リモートコマンド、自動化されているパッチの更新など、一部のアクションは実行できます。 自動化されているパッチの更新を停止するには、クライアントの［[guimenu]``システムの詳細``］ページに移動し、［[guimenu]``プロパティ``］タブで［[guimenu]``自動パッチ更新``］のチェックを外します。



== Saltクライアントのシステムのロック

Saltクライアントがロックされている場合、または停止モードになっている場合、アクションをスケジュールできず、Salt実行コマンドが無効になり、黄色のバナーが［[guimenu]``システムの詳細``］ページに表示されます。 このモードでは、{webui}またはAPIを使用してロックされているクライアントのアクションをスケジュールできますが、アクションは失敗します。


[NOTE]
====
ロックメカニズムはSalt SSHクライアントでは使用できません。
====



.プロシージャ: Saltクライアントのシステムのロック
. {productname}の{webui}で、ロックするクライアントの［[guimenu]``システムの詳細``］ページに移動します。
. ［[guimenu]``式``］タブに移動し、システムのロックの式にチェックを付け、［btn:[保存]］をクリックします。
. menu:式[System Lock（システムのロック）]タブに移動し、［[guimenu]``Lock system（システムのロック）``］にチェックを付け、［btn:[保存]］をクリックします。
    このページでは、クライアントがロックされているときに特定のSaltモジュールを有効にすることもできます。
. 変更した場合、highstateを適用する必要がある場合があります。
    この場合、{webui}のバナーで通知されます。 システムのロック式を削除するまで、クライアントはロックされたままです。


[NOTE]
====
ノードで{caasp}が検出される場合、システムのロック式はデフォルトで有効になっています。
====

Saltの停止モードの詳細については、https://docs.saltstack.com/en/latest/topics/blackout/index.htmlを参照してください。



== パッケージのロック

[NOTE]
====
パッケージのロックは、Zypperパッケージマネージャを使用している従来のクライアントでのみ使用できます。 この機能は、{rhel}またはSaltクライアントでは現在サポートされていません。
====

パッケージのロックを使用して、ソフトウェアパッケージの未認可インストールや未認可アップグレードを従来のクライアントで防止します。 パッケージがロックされている場合、南京錠のアイコンが表示され、インストールできないことを示します。 ロックされているパッケージをインストールしようとすると、イベントログにエラーとしてレポートされます。

ロックされているパッケージは、インストール、アップグレード、または削除できません。{productname}の{webui}を使用しても、パッケージマネージャを使用してクライアントマシンで直接操作しても同様です。 ロックされているパッケージでは、依存関係のあるパッケージも間接的にロックされます。


.プロシージャ: パッケージのロックの使用
. クライアントマシンで、[package]``zypp-plugin-spacewalk``パッケージを[systemitem]``root``としてインストールします。
+
----
zypper in zypp-plugin-spacewalk
----

. 管理対象システムでmenu:ソフトウェア[パッケージ > ロック]タブに移動し、使用できるパッケージの一覧を表示します。
. ロックするパッケージを選択し、［btn:[Request Lock（ロックのリクエスト）]］をクリックします。
    ロックをアクティブ化する日時を入力することもできます。 できるだけ早くロックをアクティブ化する場合、日時を空白のままにします。 ロックはすぐにはアクティブにできません。
. パッケージのロックを外すには、ロック解除するパッケージを選択し、［btn:[Request Unlock（ロック解除のリクエスト）]］をクリックします。
    できるだけ早くロックを解除する場合、日時を空白のままにします。 ロックはすぐには非アクティブにできません。
